name: IaC, Terraform Deploy to Azure

on: [push]

jobs:
       build:
              runs-on: ubuntu-latest

              steps:
                - name: "Check out"
                  uses: actions/checkout@master

                - name: "Terraform Init"
                  uses: hashicorp/terraform-github-actions@master
                  with:
                    tf_actions_verion: 0.12.13
                    tf_actions_subcommand: "init"

                - name: "Terraform Plan"
                  uses: hashicorp/terraform-github-actions@master
                  with:
                    tf_actions_verion: 0.12.13
                    tf_actions_subcommand: "plan"
                    args: '-var=client_secret=${{ secrets.clientSecret }} -var=sub_id=${{ secrets.subId }} -var=client_id=${{ secrets.clientId }} -var=tenant_id=${{ secrets.tenantId }}'

                - name: "Terraform Apply"
                  uses: hashicorp/terraform-github-actions@master
                  with:
                          tf_actions_version: 0.12.13
                    tf_actions_subcommand: "apply"
                                args: '-var=client_secret=${{ secrets.clientSecret }} -var=sub_id=${{ secrets.subId }} -var=client_id=${{ secrets.clientId }} -var=tenant_id=${{ secrets.tenantId }}'